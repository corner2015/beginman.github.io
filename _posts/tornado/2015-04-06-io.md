---
layout: post
title: "网络IO编程理解"
description: "网络IO编程理解"
category: "linux服务器"
tags: [linux服务器]
---
{% include JB/setup %}
<ul>
    <li>作者：<a href="http://weibo.com/beginman" target="blank">BeginMan</a></li>
    <li>本文地址：http://beginman.github.io</li>
    <li>转载请注明出处</li>
</ul>
<p>这几天接触Tornado,对其异步编程有点陌生，于是就恶补下网络IO的知识，以下内容整理来自网络。</p>

<h2>1.理解阻塞非阻塞与同步异步</h2>

<p><a href="http://www.zhihu.com/question/19732473">知乎地址：</a></p>

<blockquote>
  <p>因为中文语意的问题，很多时候确实会导致混用，而且语境不一样意义也可能不一样。如果只是从计算机编程这个角度说， 讨论最多的也是IO 模型 ，阻塞非阻塞 和 同步异步说的应该是不同的东西。</p>
</blockquote>

<!--more-->

<blockquote>
  <p><strong>阻塞非阻塞</strong>：可以简单理解为需要做一件事能不能立即得到返回应答，如果不能立即获得返回，需要等待，那就阻塞了，否则就可以理解为非阻塞。
  同步异步： 你总是做完一件再去做另一件，不管是否需要时间等待，这就是同步；异步呢则反之，你可以同时做几件事，并非一定需要一件事做完再做另一件事。同步简单理解成一问一答同步进行，异步可以简单理解为不必等一个问题有答了再去问另一个问题，尽管问，有答了再通知你。</p>
  
  <p>举个例子： 
  我去买一本书，立即买到了，这就是非阻塞；
  如果恰好书店没有，我就等一直等到书店有了这本书买到了才走，这就是阻塞；</p>
  
  <p>如果书店恰好没有，我就告诉书店老板，书来了告诉我一声让我来取或者直接送到我家，然后我就走了，这就是异步。
  那同步呢？ 前面两种情况，非阻塞和阻塞都可以称为同步。
  如果说书店有这书，我还让老板通知我以后来取就没这个必要了。</p>
  
  <p>反映在编程方面就是 用户进程 调用 系统调用。(用户进程对应我，内核 对应 书店老板，书对应数据资源data ， 买书就是一个系统调用了)
  这阻塞非阻塞与同步异步IO机制，都是伴随计算机系统发展，用来解决一些出现的问题。阻塞非阻塞、同步异步可以组合，但是没必要组合，应该说是不同的IO机制，没必要纠结怎么区分，如果定要组合心里才爽，可以 这样认为：阻塞非阻塞都是同步，异步就没什么阻塞不阻塞了，都异步了还阻塞啥，肯定是非阻塞了。(异步非阻塞听起来多别扭)</p>
  
  <p>unix网络编程中说到：
  将IO模型分为五类：阻塞IO，非阻塞IO，IO复用，信号驱动，异步IO
  其中阻塞IO就是那种recv, read，一直等，等到有了拷贝了数据才返回；
  非阻塞就是不用等，立即返回，设置描述符为非阻塞就行了，但是要进程自己一直检查是否可读；
  IO复用其实也是阻塞的，不过可以用来等很多描述符；
  信号驱动采用信号机制等待；
  异步IO就不用等待了，当他告知你的时候，已经可以返回了，数据都拷贝好了。</p>
  
  <p>posix.1严格定义的异步IO是要求没有任何一点阻塞，而上述的前面四个（阻塞IO，非阻塞IO，IO复用，信号驱动）都不同程度阻塞了，而且都有一个共同的阻塞： 内核拷贝数据到进程空间的这段时间需要等待。 (这么说上面的举例中： 必须要书送到我家，否则都不算异步，纠结。。。)</p>
</blockquote>

<h2>2.IO原理</h2>

<p>对于数据流向，网络IO操作实际过程涉及到内核和调用这个IO操作的进程。以read为例，read的具体操作分为以下两个部分:</p>

<p>　　（1）内核等待数据可读</p>

<p>　　（2）将内核读到的数据拷贝到进程
　　
<img src="http://images.cnitblog.com/blog/305504/201308/12224938-4db3844232b84fb284d057a21df5f149.png" alt="" />　</p>

<p>图片来源：http://images.cnitblog.com/blog/305504/201308/12224938-4db3844232b84fb284d057a21df5f149.png</p>

<p>对于tornado来说，它一款非阻塞可扩展web服务器和Web框架, 可以使用Tornado编写Web程序并不依赖任何web服务器直接提供高效的web服务.所以Tornado不仅仅是一个web框架而且还是一款可以用于生产环境的高效的web服务器。</p>

<p>明白了网络IO的阻塞与非阻塞，同步与异步后，就能够更加理解Tornado异步编程了。</p>

<p>　</p>
